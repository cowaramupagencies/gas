<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gas Bottle Order System</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <!-- Login Gate -->
    <div id="login-gate" class="login-gate">
        <div class="login-container">
            <img src="cowaglogo.png" alt="Company Logo" class="login-logo">
            <h2>Gas Orders System</h2>
            <form id="login-form">
                <div class="form-group">
                    <label for="login-email">Email</label>
                    <input type="email" id="login-email" required autocomplete="email" placeholder="your@email.com">
                </div>
                <div class="form-group">
                    <label for="login-password">Password</label>
                    <input type="password" id="login-password" required autocomplete="current-password" placeholder="Enter password">
                </div>
                <button type="submit" class="login-btn">Login</button>
                <div id="login-error" class="login-error"></div>
                <div class="login-help">
                    <small>Need to create a user? Go to Firebase Console → Authentication → Users → Add user</small>
                </div>
            </form>
        </div>
    </div>

    <!-- Main App (hidden until logged in) -->
    <div id="main-app" class="main-app" style="display: none;">
    <div class="container">
        <header>
            <img src="cowaglogo.png" alt="Company Logo" class="header-logo">
            <button type="button" class="reset-btn" id="reset-data-btn" title="Reset all data (testing only)">Reset Data</button>
        </header>

        <!-- Main View Toggle -->
        <div class="main-view-toggle">
            <button type="button" class="view-toggle-btn active" id="customer-view-btn">CUSTOMER</button>
            <button type="button" class="view-toggle-btn" id="staff-view-btn">STAFF / ADMIN</button>
        </div>

        <!-- CUSTOMER VIEW (Order Entry) -->
        <div class="view-section" id="customer-view">
            <!-- Customer Search Section -->
        <section class="search-section">
            <label for="customer-search">Search Customer</label>
            <input 
                type="text" 
                id="customer-search" 
                placeholder="Search name, mobile, or address…"
                autocomplete="off"
            >
            <div id="search-results" class="search-results"></div>
        </section>

        <!-- Customer Details Section -->
        <section class="customer-section">
            <h2>Customer Details</h2>
            <div class="form-group">
                <label for="customer-name">Name <span class="required">*</span></label>
                <input type="text" id="customer-name" required>
            </div>
            <div class="form-group">
                <label for="customer-mobile">Mobile <span class="required">*</span></label>
                <input type="text" id="customer-mobile" required>
            </div>
            <div class="form-group">
                <label for="customer-address">Address <span class="required">*</span></label>
                <textarea id="customer-address" rows="2" required></textarea>
            </div>
        </section>

        <!-- Order Details Section -->
        <section class="order-section">
            <h2>Order Details</h2>
            
            <div class="form-group">
                <label>Bottles <span class="required">*</span></label>
                <p class="field-hint">At least one bottle type must have quantity &gt; 0</p>
                <div class="bottle-selector-list">
                    <div class="bottle-row" data-type="45kg">
                        <span class="bottle-label">45kg</span>
                        <div class="quantity-controls">
                            <button type="button" class="qty-btn bottle-qty-minus" data-type="45kg">−</button>
                            <input type="number" id="bottle-qty-45kg" value="0" min="0" max="99" readonly class="bottle-qty-input">
                            <button type="button" class="qty-btn bottle-qty-plus" data-type="45kg">+</button>
                        </div>
                    </div>
                    <div class="bottle-row" data-type="8.5kg">
                        <span class="bottle-label">8.5kg</span>
                        <div class="quantity-controls">
                            <button type="button" class="qty-btn bottle-qty-minus" data-type="8.5kg">−</button>
                            <input type="number" id="bottle-qty-8.5kg" value="0" min="0" max="99" readonly class="bottle-qty-input">
                            <button type="button" class="qty-btn bottle-qty-plus" data-type="8.5kg">+</button>
                        </div>
                    </div>
                    <div class="bottle-row" data-type="Forklift 18kg">
                        <span class="bottle-label">Forklift 18kg</span>
                        <div class="quantity-controls">
                            <button type="button" class="qty-btn bottle-qty-minus" data-type="Forklift 18kg">−</button>
                            <input type="number" id="bottle-qty-Forklift 18kg" value="0" min="0" max="99" readonly class="bottle-qty-input">
                            <button type="button" class="qty-btn bottle-qty-plus" data-type="Forklift 18kg">+</button>
                        </div>
                    </div>
                    <div class="bottle-row" data-type="Forklift 15kg">
                        <span class="bottle-label">Forklift 15kg</span>
                        <div class="quantity-controls">
                            <button type="button" class="qty-btn bottle-qty-minus" data-type="Forklift 15kg">−</button>
                            <input type="number" id="bottle-qty-Forklift 15kg" value="0" min="0" max="99" readonly class="bottle-qty-input">
                            <button type="button" class="qty-btn bottle-qty-plus" data-type="Forklift 15kg">+</button>
                        </div>
                    </div>
                </div>
                <div id="bottle-total-display" class="bottle-total-display">Total: 0 bottles</div>
            </div>

            <div class="form-group">
                <label>Preferred Delivery Day</label>
                <div class="radio-group">
                    <label class="radio-label">
                        <input type="radio" name="preferred-day" value="Tuesday">
                        Tuesday
                    </label>
                    <label class="radio-label">
                        <input type="radio" name="preferred-day" value="Friday">
                        Friday
                    </label>
                    <label class="radio-label">
                        <input type="radio" name="preferred-day" value="Any" checked>
                        Any
                    </label>
                </div>
            </div>

            <div class="form-group">
                <label for="order-notes">Order Notes (Optional)</label>
                <textarea id="order-notes" rows="3" placeholder="Gate codes, dogs on site, access instructions..."></textarea>
            </div>
        </section>

        <!-- Staff Options Section (Collapsed) -->
        <section class="staff-section">
            <button type="button" class="staff-toggle" id="staff-toggle">
                Staff options ▸
            </button>
            <div class="staff-options" id="staff-options" style="display: none;">
                <div class="form-group">
                    <label for="delivery-date">Delivery Date</label>
                    <input type="date" id="delivery-date">
                </div>
                <div class="form-group">
                    <label for="assign-run">Assign to Run</label>
                    <select id="assign-run">
                        <option value="">Auto</option>
                    </select>
                    <p class="field-hint" id="assign-run-hint">Select a date to see runs. Max 8 bottles per run.</p>
                </div>
                <div class="form-group">
                    <label for="invoice-number">Invoice Number</label>
                    <input type="text" id="invoice-number">
                </div>
            </div>
        </section>

        <!-- Save Button -->
        <section class="save-section">
            <button type="button" class="save-btn" id="save-order">SAVE ORDER</button>
            <div id="save-message" class="save-message"></div>
        </section>
        </div>

        <!-- STAFF / ADMIN VIEW -->
        <div class="view-section" id="staff-view" style="display: none;">
            <section class="staff-admin-section">
                <div class="staff-admin-content">
                    
                    <!-- Navigation Tabs -->
                    <div class="staff-tabs">
                        <button class="staff-tab" data-tab="stock-count">Stock Count</button>
                        <button class="staff-tab active" data-tab="undelivered">Undelivered Orders</button>
                        <button class="staff-tab" data-tab="run-builder">Run Builder</button>
                        <button class="staff-tab" data-tab="generated-runs">Generated Runs</button>
                        <button class="staff-tab" data-tab="daily-view">Daily/Weekly View</button>
                        <button class="staff-tab" data-tab="customer-history">Customer History</button>
                    </div>

                <!-- Undelivered Orders Tab -->
                <div class="staff-tab-content active" id="tab-undelivered">
                    <h3>Undelivered Bottles / Unassigned Orders</h3>
                    
                    <!-- Summary Strip -->
                    <div id="undelivered-summary-strip" class="summary-strip"></div>
                    
                    <div class="undelivered-search">
                        <label for="undelivered-search">Search Orders</label>
                        <input 
                            type="text" 
                            id="undelivered-search" 
                            placeholder="Search by customer name, mobile, or address..."
                            autocomplete="off"
                        >
                    </div>
                    
                    <div id="undelivered-orders-table" class="undelivered-table-container"></div>
                </div>
                
                <!-- Edit Order Modal -->
                <div id="edit-order-modal" class="modal" style="display: none;">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h2>Edit Order</h2>
                            <button type="button" class="modal-close" onclick="closeEditOrderModal()">&times;</button>
                        </div>
                        <div class="modal-body">
                            <form id="edit-order-form">
                                <input type="hidden" id="edit-order-id">
                                
                                <!-- Customer Details -->
                                <section class="customer-section">
                                    <h3>Customer Details</h3>
                                    <div class="form-group">
                                        <label for="edit-customer-name">Name <span class="required">*</span></label>
                                        <input type="text" id="edit-customer-name" required>
                                    </div>
                                    <div class="form-group">
                                        <label for="edit-customer-mobile">Mobile <span class="required">*</span></label>
                                        <input type="text" id="edit-customer-mobile" required>
                                    </div>
                                    <div class="form-group">
                                        <label for="edit-customer-address">Address <span class="required">*</span></label>
                                        <textarea id="edit-customer-address" rows="2" required></textarea>
                                    </div>
                                </section>
                                
                                <!-- Order Details -->
                                <section class="order-section">
                                    <h3>Order Details</h3>
                                    
                                    <div class="form-group">
                                        <label>Bottles <span class="required">*</span></label>
                                        <div class="bottle-selector-list">
                                            <div class="bottle-row" data-type="45kg">
                                                <span class="bottle-label">45kg</span>
                                                <div class="quantity-controls">
                                                    <button type="button" class="qty-btn bottle-qty-minus-edit" data-type="45kg">−</button>
                                                    <input type="number" id="edit-bottle-qty-45kg" value="0" min="0" max="99" readonly class="bottle-qty-input">
                                                    <button type="button" class="qty-btn bottle-qty-plus-edit" data-type="45kg">+</button>
                                                </div>
                                            </div>
                                            <div class="bottle-row" data-type="8.5kg">
                                                <span class="bottle-label">8.5kg</span>
                                                <div class="quantity-controls">
                                                    <button type="button" class="qty-btn bottle-qty-minus-edit" data-type="8.5kg">−</button>
                                                    <input type="number" id="edit-bottle-qty-8.5kg" value="0" min="0" max="99" readonly class="bottle-qty-input">
                                                    <button type="button" class="qty-btn bottle-qty-plus-edit" data-type="8.5kg">+</button>
                                                </div>
                                            </div>
                                            <div class="bottle-row" data-type="Forklift 18kg">
                                                <span class="bottle-label">Forklift 18kg</span>
                                                <div class="quantity-controls">
                                                    <button type="button" class="qty-btn bottle-qty-minus-edit" data-type="Forklift 18kg">−</button>
                                                    <input type="number" id="edit-bottle-qty-Forklift 18kg" value="0" min="0" max="99" readonly class="bottle-qty-input">
                                                    <button type="button" class="qty-btn bottle-qty-plus-edit" data-type="Forklift 18kg">+</button>
                                                </div>
                                            </div>
                                            <div class="bottle-row" data-type="Forklift 15kg">
                                                <span class="bottle-label">Forklift 15kg</span>
                                                <div class="quantity-controls">
                                                    <button type="button" class="qty-btn bottle-qty-minus-edit" data-type="Forklift 15kg">−</button>
                                                    <input type="number" id="edit-bottle-qty-Forklift 15kg" value="0" min="0" max="99" readonly class="bottle-qty-input">
                                                    <button type="button" class="qty-btn bottle-qty-plus-edit" data-type="Forklift 15kg">+</button>
                                                </div>
                                            </div>
                                        </div>
                                        <div id="edit-bottle-total-display" class="bottle-total-display">Total: 0 bottles</div>
                                    </div>
                                    
                                    <div class="form-group">
                                        <label>Preferred Delivery Day</label>
                                        <div class="radio-group">
                                            <label class="radio-label">
                                                <input type="radio" name="edit-preferred-day" value="Tuesday">
                                                Tuesday
                                            </label>
                                            <label class="radio-label">
                                                <input type="radio" name="edit-preferred-day" value="Friday">
                                                Friday
                                            </label>
                                            <label class="radio-label">
                                                <input type="radio" name="edit-preferred-day" value="Any" checked>
                                                Any
                                            </label>
                                        </div>
                                    </div>
                                    
                                    <div class="form-group">
                                        <label for="edit-order-notes">Order Notes (Optional)</label>
                                        <textarea id="edit-order-notes" rows="3" placeholder="Gate codes, dogs on site, access instructions..."></textarea>
                                    </div>
                                </section>
                                
                                <!-- Staff Options -->
                                <section class="staff-section">
                                    <button type="button" class="staff-toggle" id="edit-staff-toggle">
                                        Staff options ▸
                                    </button>
                                    <div class="staff-options" id="edit-staff-options" style="display: none;">
                                        <div class="form-group">
                                            <label for="edit-delivery-date">Delivery Date</label>
                                            <input type="date" id="edit-delivery-date">
                                        </div>
                                        <div class="form-group">
                                            <label for="edit-assign-run">Assign to Run</label>
                                            <select id="edit-assign-run">
                                                <option value="">Auto</option>
                                            </select>
                                            <p class="field-hint" id="edit-assign-run-hint">Select a date to see runs. Max 8 bottles per run (45kg only).</p>
                                        </div>
                                        <div class="form-group">
                                            <label for="edit-invoice-number">Invoice Number</label>
                                            <input type="text" id="edit-invoice-number">
                                        </div>
                                    </div>
                                </section>
                                
                                <div class="modal-actions">
                                    <button type="button" class="btn-secondary" onclick="closeEditOrderModal()">Cancel</button>
                                    <button type="button" class="save-btn" onclick="saveEditedOrder()">Save Changes</button>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>

                <!-- Generated Runs Tab -->
                <div class="staff-tab-content" id="tab-generated-runs">
                    <h3>Generated Runs / Delivery History</h3>
                    <div id="generated-runs-list" class="generated-runs-list"></div>
                    <div id="run-detail-view" class="run-detail-view" style="display: none;"></div>
                </div>

                <!-- Daily/Weekly View Tab -->
                <div class="staff-tab-content" id="tab-daily-view">
                    <h3>Daily & Weekly View</h3>
                    
                    <!-- Weekly Overview -->
                    <div class="weekly-overview">
                        <h4>Weekly Overview</h4>
                        <div class="week-selector">
                            <button id="prev-week">← Prev Week</button>
                            <span id="week-range"></span>
                            <button id="next-week">Next Week →</button>
                        </div>
                        <div id="weekly-grid" class="weekly-grid"></div>
                    </div>

                    <!-- Daily View -->
                    <div class="daily-view">
                        <h4>Daily View</h4>
                        <div class="form-group">
                            <label for="daily-view-date">Select Date</label>
                            <input type="date" id="daily-view-date">
                        </div>
                        <div id="daily-orders" class="daily-orders-table"></div>
                    </div>
                </div>

                <!-- Run Builder Tab -->
                <div class="staff-tab-content" id="tab-run-builder">
                    <h3>Run Builder</h3>
                    <div class="form-group">
                        <label for="run-date">Delivery Date</label>
                        <input type="date" id="run-date">
                    </div>
                    <div id="run-builder-content"></div>
                </div>

                <!-- Stock Count Tab -->
                <div class="staff-tab-content" id="tab-stock-count">
                    <h3>Stock Count</h3>
                    <p class="section-description">Undelivered bottle totals for stock counting</p>
                    <div id="stock-summary" class="stock-summary"></div>
                </div>

                <!-- Customer History Tab -->
                <div class="staff-tab-content" id="tab-customer-history">
                    <h3>Customer History</h3>
                    
                    <div class="customer-history-search">
                        <label for="customer-history-search">Search Customers</label>
                        <input 
                            type="text" 
                            id="customer-history-search" 
                            placeholder="Search by customer name, mobile, or address..."
                            autocomplete="off"
                        >
                    </div>
                    
                    <div id="customer-history-list" class="customer-history-list"></div>
                </div>
                

                </div>
            </section>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.4/firebase-app.js";
        import { getAuth } from "https://www.gstatic.com/firebasejs/10.12.4/firebase-auth.js";
        import { getFirestore } from "https://www.gstatic.com/firebasejs/10.12.4/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyCrk6FhryTT_isTw8l5eOV4moSU5dH8ygg",
            authDomain: "gas-orders.firebaseapp.com",
            projectId: "gas-orders",
            storageBucket: "gas-orders.firebasestorage.app",
            messagingSenderId: "803594044209",
            appId: "1:803594044209:web:14e3e2608d8c94d824a610"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        // expose globally for app.js
        window.firebaseApp = app;
        window.firebaseAuth = auth;
        window.firebaseDB = db;
    </script>

    </div>
    </div>

    <script src="app.js"></script>
</body>
</html>
